<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Admin - Commande Consommables</title>
    <style>
        :root {
            --accent-blue: #0078d7;
            --digi-dark: #1f2937;
            --card-bg: #ffffff;
            --muted: #6b7280;
            --border: #e5e7eb;
        }
        body {
            font-family: Arial, sans-serif;
            background: #ffffff;
            margin: 0;
            padding: 0;
            color: #4b5563;
        }
        header {
            background: #ffffff;
            color: #4b5563;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid var(--border);
        }
        header .logo {
            height: 44px;
            width: auto;
            display: block;
        }
        header h1 { margin: 0; font-size: 20px; color: var(--digi-dark); }
        nav {
            background: #f5f5f5;
            padding: 12px 24px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.04);
            display: flex;
            gap: 12px;
            border-bottom: 1px solid var(--border);
        }
        nav a { text-decoration: none; color: #4b5563; font-weight: bold; }
        nav a:hover { color: var(--accent-blue); }
        nav.subnav a { padding: 8px 12px; border-radius: 8px; border: 1px solid transparent; }
        nav.subnav a.active { background: #e0e7ff; color: #1d4ed8; border-color: #bfdbfe; }
        .container { max-width: 1200px; margin: 24px auto; padding: 0 16px; }
        .card {
            background: #f8fafc;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            margin-bottom: 18px;
            border: 1px solid var(--border);
        }
        .flex { display: flex; gap: 16px; flex-wrap: wrap; }
        .panel { flex: 1 1 360px; background: #ffffff; border: 1px solid var(--border); border-radius: 8px; padding: 14px; overflow-x: auto; }
        .panel h3 { margin-top: 0; color: var(--digi-dark); }
        label { display: block; font-weight: bold; margin: 8px 0 4px; color: var(--digi-dark); }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: #fff;
        }
.user-form-grid{
            display:grid;
            gap:16px;
            align-items:end;

            /* desktop: 4 colonnes sur 1 ligne */
            grid-template-columns: minmax(0,1fr) minmax(0,1fr) minmax(0,1fr) minmax(0,1.2fr);
            grid-template-areas: "user role pass btn";
        }

        /* Assigne chaque bloc à une zone */
        .user-form-grid > div:nth-child(1){ grid-area:user; }
        .user-form-grid > div:nth-child(2){ grid-area:role; }
        .user-form-grid > div:nth-child(3){ grid-area:pass; }
        .user-form-grid > div:nth-child(4){ grid-area:btn; }

        .user-form-grid input,
        .user-form-grid select,
        .user-form-grid button { width: 100%; }
        .user-form-grid button { white-space: nowrap; }

        /* tablette: 2 colonnes, 2 lignes */
        @media (max-width: 960px){
            .user-form-grid{
                grid-template-columns: repeat(2, minmax(0,1fr));
                grid-template-areas:
                  "user role"
                  "pass btn";
            }
        }

        /* mobile: 1 colonne */
        @media (max-width: 640px){
            .user-form-grid{
                grid-template-columns: 1fr;
                grid-template-areas:
                  "user"
                  "role"
                  "pass"
                  "btn";
            }
        }

        /* Important si une classe .full existe ailleurs */
        .user-form-grid .full{
            grid-column:auto !important;
        }
        .editable-table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            table-layout: auto;
            font-size: 14px;
        }
        .editable-table thead th {
            background: #f1f5f9;
            font-weight: 700;
            font-size: 13px;
            color: #374151;
            letter-spacing: 0.01em;
            position: relative;
        }
        .editable-table td,
        .editable-table th {
            vertical-align: middle;
            padding: 10px 12px;
            border: 1px solid #e5e7eb;
        }
        .editable-table tbody tr:hover {
            background: #f8fafc;
        }
        .editable-table .add-row td {
            background: #f9fafb;
        }
        .editable-table input,
        .editable-table select {
            width: 100%;
            box-sizing: border-box;
            border-radius: 6px;
        }
        .editable-table .add-row input,
        .editable-table .add-row select {
            border: none;
            background: transparent;
            padding: 0;
            height: auto;
            border-radius: 0;
            color: inherit;
            box-shadow: none;
        }
        .editable-table tbody tr:not(.add-row):not(.editing) input,
        .editable-table tbody tr:not(.add-row):not(.editing) select {
            border: none;
            background: transparent;
            padding: 0;
            height: auto;
            color: inherit;
            border-radius: 0;
            pointer-events: none;
        }
        .editable-table tbody tr.editing input,
        .editable-table tbody tr.editing select {
            border: 1px solid #d1d5db;
            background: #fff;
            padding: 6px 8px;
            height: 32px;
            border-radius: 6px;
            pointer-events: auto;
        }
        .editable-table tbody tr:not(.add-row):not(.editing) input:focus,
        .editable-table tbody tr:not(.add-row):not(.editing) select:focus,
        .editable-table .add-row input:focus,
        .editable-table .add-row select:focus,
        .editable-table tbody tr.editing input:focus,
        .editable-table tbody tr.editing select:focus {
            outline: none;
            border: 1px solid #93c5fd;
            background: #f8fbff;
        }
        .editable-table .add-row input:focus,
        .editable-table .add-row select:focus {
            border: none;
            background: transparent;
        }
        .editable-table button {
            height: 36px;
        }
        .editable-table .wide {
            min-width: 140px;
        }
        .pager {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            justify-content: flex-end;
            font-size: 13px;
            color: #4b5563;
        }
        .pager button {
            height: 36px;
            padding: 0 12px;
            background: #eef2f7;
            color: #1f2937;
        }
        .table-actions {
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: flex-start;
            height: 100%;
            white-space: nowrap;
        }
        .action-btn {
            min-width: auto;
            text-align: center;
            flex: 0 0 auto;
            width: auto;
        }
        .table-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
            align-items: center;
            height: 100%;
            white-space: nowrap;
        }
        .catalog-table {
            table-layout: auto;
        }
        .catalog-table th,
        .catalog-table td {
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .catalog-table .actions-col,
        .catalog-table .table-actions {
            width: 180px;
        }
        .catalog-table .add-row .table-actions {
            justify-content: flex-end;
        }
        .qr-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: nowrap;
            width: 90px;
            min-width: 90px;
            padding: 6px 4px;
            height: 64px;
            vertical-align: middle;
        }
        .add-row .qr-cell {
            height: 64px;
        }
        .col-qr {
            width: 90px;
            min-width: 90px;
        }
        .col-actions {
            width: auto;
            min-width: 160px;
        }
        .qr-btn {
            width: 44px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            background: #f8fafc;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.15s, border-color 0.15s;
        }
        .qr-btn svg {
            width: 18px;
            height: 18px;
            fill: #1f2937;
        }
        .qr-btn:hover {
            background: #eef2f7;
            border-color: #cbd5e1;
        }
        .qr-cell img {
            display: block;
            height: 48px;
            width: 48px;
        }
        .qr-placeholder {
            width: 48px;
            height: 48px;
            background: transparent;
        }
        .qr-box {
            width: 52px;
            height: 52px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
            box-sizing: border-box;
        }
        button {
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        button.secondary { background: #eef2f7; color: #4b5563; }
        button.danger { background: #fee2e2; color: #991b1b; }
        table { width: 100%; border-collapse: collapse; margin-top: 12px; }
        th, td { padding: 10px; border-bottom: 1px solid var(--border); text-align: left; }
        th { background: #f8fafc; color: var(--digi-dark); }
        .tag { display: inline-block; background: #f1f5f9; color: #4b5563; padding: 4px 8px; border-radius: 999px; font-size: 12px; }
        .hidden { display: none; }
        .status { display: inline-block; padding: 4px 10px; border-radius: 999px; font-size: 12px; font-weight: bold; }
        .status.traitement { background: #fff7ed; color: #c2410c; border: 1px solid #fed7aa; }
        .status.preparation { background: #ecfeff; color: #0ea5e9; border: 1px solid #bae6fd; }
        .status.envoye { background: #ecfdf3; color: #16a34a; border: 1px solid #bbf7d0; }
        .status.inconnu { background: #f1f5f9; color: #475569; border: 1px solid #e5e7eb; }
        /* Ajuster colonnes actions et QR sur tables sans classes */
        #tableAdminOrders th:last-child,
        #tableAdminOrders td:last-child,
        #tableUsers th:last-child,
        #tableUsers td:last-child {
            width: 140px;
            min-width: 120px;
            text-align: center;
        }
        .editable-table .add-row .col-actions button,
        .editable-table .add-row .table-actions button {
            width: 100%;
        }
        .col-resize-handle {
            position: absolute;
            top: 0;
            right: -4px;
            width: 8px;
            height: 100%;
            cursor: col-resize;
            user-select: none;
        }
        .col-resize-handle:hover {
            background: rgba(0,0,0,0.04);
        }
        @media (max-width: 960px) {
            body { font-size: 14px; }
            header, nav { padding: 12px 16px; }
            .card { padding: 14px; }
            .editable-table td,
            .editable-table th { padding: 8px 10px; }
            .editable-table { font-size: 13px; }
        }
        @media (max-width: 640px) {
            header { flex-wrap: wrap; gap: 8px; }
            nav { flex-wrap: wrap; }
            .card { margin: 16px auto; }
            .panel { padding: 12px; }
        }
    </style>
</head>
<body>
    <header>
        <img src="logo_pdf.png" alt="Logo DIGI" class="logo">
        <h1>Admin - Commande Consommables</h1>
        <span class="tag" id="adminUserTag"></span>
        <button id="btnLogout" style="margin-left:auto;">Déconnexion</button>
    </header>
    <nav class="subnav">
        <a href="#enseignes" id="tabEnseignes">Enseignes</a>
        <a href="#clients" id="tabClients">Comptes clients</a>
        <a href="#prix" id="tabPrix">Prix par enseigne</a>
        <a href="#catalogue" id="tabCatalogue">Catalogue</a>
        <a href="#commandes" id="tabCommandes">Commandes</a>
        <a href="#users" id="tabUsers">Utilisateurs</a>
    </nav>

    <div class="container">
                <section id="sectionEnseignes" class="card">
            <h2>Parametrage des enseignes</h2>
            <div class="panel">
                <table id="tableEnseignes" class="editable-table">
                    <thead>
                        <tr><th>Code</th><th>Nom</th><th>Email compta</th><th class="col-actions">Actions</th></tr>
                    </thead>
                    <tbody>
                        <tr class="add-row">
                            <td><input type="text" id="ensCode" placeholder="Ex: C001"></td>
                            <td><input type="text" id="ensName" placeholder="Ex: Intermarche"></td>
                            <td><input type="email" id="ensEmail" placeholder="exemple@domaine.com"></td>
                            <td class="col-actions"><button id="btnAddEnseigne">Ajouter</button></td>
                        </tr>
                    </tbody>
                </table>
                <div class="pager">
                    <button id="enseignePrev">Précédent</button>
                    <span id="enseignePageLabel"></span>
                    <button id="enseigneNext">Suivant</button>
                </div>
            </div>
        </section>

                <section id="sectionClients" class="card hidden">
            <h2>Parametrage des comptes clients</h2>
            <div class="panel">
                <table id="tableClients" class="editable-table">
                    <thead>
                        <tr><th>ID</th><th>Enseigne</th><th>Magasin</th><th>Contact</th><th>Email</th><th class="col-actions">Actions</th></tr>
                    </thead>
                    <tbody>
                        <tr class="add-row">
                            <td><input type="text" id="cliId" placeholder="Ex: C001"></td>
                            <td>
                                <select id="cliEnseigneSelect">
                                    <option value="">-- Choisir une enseigne --</option>
                                </select>
                            </td>
                            <td><input type="text" id="cliMagasin" placeholder="Ex: Paris 15"></td>
                            <td><input type="text" id="cliContact"></td>
                            <td><input type="email" id="cliEmail"></td>
                            <td class="table-actions col-actions"><button id="btnAddClient" class="action-btn">Ajouter</button></td>
                        </tr>
                    </tbody>
                </table>
                <div class="pager">
                    <button id="clientsPrev">Précédent</button>
                    <span id="clientsPageLabel"></span>
                    <button id="clientsNext">Suivant</button>
                </div>
            </div>
        </section>
        <section id="sectionPrix" class="card hidden">
            <h2>Parametrage des prix par enseigne</h2>
            <div class="panel">
                <div class="flex" style="align-items: flex-end; gap: 12px; margin-bottom: 10px;">
                    <div style="flex:1 1 260px;">
                        <label>Enseigne</label>
                        <select id="prixEnseigneSelect"></select>
                    </div>
                    <div style="flex:1 1 260px;">
                        <label>Produit (catalogue unique)</label>
                        <select id="prixProduitGlobalSelect">
                            <option value="">-- Nouveau produit --</option>
                        </select>
                    </div>
                </div>
                <table id="tablePrix" class="editable-table">
                    <thead>
                        <tr><th>ID Produit</th><th>Nom</th><th>Prix (EUR)</th><th class="col-actions">Actions</th></tr>
                    </thead>
                    <tbody>
                        <tr class="add-row">
                            <td><input type="number" id="prixId" placeholder="Ex: 1"></td>
                            <td><input type="text" id="prixNom" placeholder="Ex: Film alimentaire 450 mm"></td>
                            <td><input type="number" step="0.01" id="prixValeur" placeholder="Ex: 12.50"></td>
                            <td class="col-actions"><button id="btnAddPrix">Ajouter</button></td>
                        </tr>
                    </tbody>
                </table>
                <div class="pager">
                    <button id="prixPrev">Précédent</button>
                    <span id="prixPageLabel"></span>
                    <button id="prixNext">Suivant</button>
                </div>
            </div>
        </section>

        <section id="sectionCatalogue" class="card hidden">
            <h2>Catalogue produits</h2>
            <div class="panel">
                <table id="tableCatalogue" class="editable-table catalog-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Référence</th>
                            <th class="wide">Désignation</th>
                            <th>Mandrin</th>
                            <th>Étiquettes / rouleau</th>
                            <th>Rouleaux / carton</th>
                            <th>Prix carton HT</th>
                            <th class="actions-col col-actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="add-row">
                            <td><input type="number" id="catId" placeholder="Auto" disabled value=""></td>
                            <td><input type="text" id="catRef" placeholder="Ex: DIGI604840V"></td>
                            <td><input type="text" id="catNom" placeholder="Ex: Etiquette blanche 60x48"></td>
                            <td><input type="text" id="catMandrin" placeholder="Ex: Ø40mm"></td>
                            <td><input type="number" id="catEtiquettes" placeholder="Ex: 800"></td>
                            <td><input type="number" id="catRouleaux" placeholder="Ex: 24"></td>
                            <td><input type="number" step="0.01" id="catPrix" placeholder="Ex: 72.24"></td>
                            <td class="table-actions col-actions"><button id="btnAddProduitGlobal" class="action-btn">Ajouter</button></td>
                        </tr>
                    </tbody>
                </table>
                <div class="pager">
                    <button id="cataloguePrev">Précédent</button>
                    <span id="cataloguePageLabel"></span>
                    <button id="catalogueNext">Suivant</button>
                </div>
            </div>
        </section>

                <section id="sectionCommandes" class="card hidden">
            <h2>Commandes</h2>
            <div class="panel">
                <div class="flex" style="align-items: flex-end; gap: 12px; margin-bottom: 10px;">
                    <div style="flex:1 1 260px;">
                        <label>Filtrer par enseigne</label>
                        <select id="ordersEnseigneSelect">
                            <option value="">Toutes les enseignes</option>
                        </select>
                    </div>
                </div>
                <table id="tableAdminOrders" class="editable-table">
                    <thead>
                        <tr>
                            <th>R&eacute;f.</th>
                            <th>Client</th>
                            <th>Magasin</th>
                            <th>Total</th>
                            <th>Date</th>
                            <th>Statut</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="7" class="muted">Chargement...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section id="sectionUsers" class="card hidden">
            <h2>Gestion des utilisateurs / mots de passe</h2>
            <div class="panel" style="margin-bottom:12px;">
                <div class="user-form-grid">
                    <div>
                        <label for="userIdInput">Utilisateur</label>
                        <input id="userIdInput" type="text" placeholder="Ex: C001 ou admin">
                    </div>
                    <div>
                        <label for="userRoleSelect">Rôle</label>
                        <select id="userRoleSelect">
                            <option value="client">client</option>
                            <option value="admin">admin</option>
                        </select>
                    </div>
                    <div>
                        <label for="userPasswordInput">Mot de passe (optionnel)</label>
                        <input id="userPasswordInput" type="text" placeholder="Laisser vide pour conserver">
                    </div>
                    <div>
                        <button id="btnSaveUser" class="full">Créer / mettre à jour</button>
                    </div>
                </div>
                <p class="muted" style="margin-top:6px;">Laisser le mot de passe vide pour garder celui existant. Le rôle est mis à jour dans tous les cas.</p>
            </div>
            <div class="panel">
                <table id="tableUsers" class="editable-table">
                    <thead>
                        <tr>
                            <th>Utilisateur</th>
                            <th>Rôle</th>
                            <th>Enseigne</th>
                            <th>Magasin</th>
                            <th>Dernier login</th>
                            <th class="col-actions">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="6" class="muted">Chargement...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <script src="admin.js"></script>
    <script>
        (function enableResizableTables() {
            function applyResize(table) {
                if (!table || table.dataset.resizable === "true") return;
                table.dataset.resizable = "true";
                const headers = table.querySelectorAll("thead th");
                headers.forEach((th, index) => {
                    const handle = document.createElement("span");
                    handle.className = "col-resize-handle";
                    th.appendChild(handle);
                    let startX = 0;
                    let startWidth = 0;
                    const onMouseMove = (e) => {
                        const delta = e.pageX - startX;
                        const newWidth = Math.max(60, startWidth + delta);
                        th.style.width = newWidth + "px";
                        table.querySelectorAll(`tbody tr td:nth-child(${index + 1})`).forEach((td) => {
                            td.style.width = newWidth + "px";
                        });
                    };
                    const onMouseUp = () => {
                        document.removeEventListener("mousemove", onMouseMove);
                        document.removeEventListener("mouseup", onMouseUp);
                    };
                    handle.addEventListener("mousedown", (e) => {
                        e.preventDefault();
                        startX = e.pageX;
                        startWidth = th.offsetWidth;
                        document.addEventListener("mousemove", onMouseMove);
                        document.addEventListener("mouseup", onMouseUp);
                    });
                });
            }
            document.addEventListener("DOMContentLoaded", () => {
                document.querySelectorAll(".editable-table").forEach(applyResize);
            });
        })();
    </script>
</body>
</html>
