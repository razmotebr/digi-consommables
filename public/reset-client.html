<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Réinitialiser le mot de passe</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f8fafc; margin:0; display:flex; align-items:center; justify-content:center; min-height:100vh; }
        .card { background:#fff; padding:24px; border:1px solid #e5e7eb; border-radius:12px; box-shadow:0 12px 30px rgba(0,0,0,0.06); width:100%; max-width:420px; }
        h1 { margin:0 0 6px 0; color:#1f2937; }
        p { margin:0 0 16px 0; color:#6b7280; }
        label { display:block; margin:12px 0 6px; font-weight:bold; color:#1f2937; }
        input { width:100%; padding:10px; border:1px solid #e5e7eb; border-radius:8px; }
        button { width:100%; margin-top:16px; padding:12px; background:#0078d7; color:#fff; border:none; border-radius:8px; font-weight:bold; cursor:pointer; }
        .msg { margin-top:12px; color:#16a34a; min-height:18px; }
        .error { margin-top:12px; color:#b91c1c; min-height:18px; }
        a { color:#0078d7; text-decoration:none; }
    </style>
</head>
<body>
    <div class="card">
        <h1>Nouveau mot de passe</h1>
        <p>Renseignez un nouveau mot de passe.</p>
        <label for="newPass">Mot de passe</label>
        <input id="newPass" type="password">
        <button id="btnReset">Mettre à jour</button>
        <div class="msg" id="msgOk"></div>
        <div class="error" id="msgErr"></div>
        <div style="margin-top:12px; text-align:center;"><a href="/login.html">Retour connexion</a></div>
    </div>
    <script>
    const params = new URLSearchParams(window.location.search);
    const token = params.get("token") || "";
    if (!token) {
        document.getElementById("msgErr").textContent = "Token manquant.";
        document.getElementById("btnReset").disabled = true;
    }
    document.getElementById("btnReset").addEventListener("click", async () => {
        const pass = document.getElementById("newPass").value;
        const ok = document.getElementById("msgOk");
        const err = document.getElementById("msgErr");
        ok.textContent = "";
        err.textContent = "";
        if (!pass) { err.textContent = "Mot de passe requis"; return; }
        document.getElementById("btnReset").disabled = true;
        try {
            const res = await fetch("/reset_client", {
                method: "POST",
                headers: { "content-type": "application/json" },
                body: JSON.stringify({ token, password: pass })
            });
            const data = await res.json();
            if (!res.ok) throw new Error(data.error || "Erreur");
            ok.textContent = data.message || "Mot de passe mis à jour.";
        } catch (e) {
            err.textContent = e.message;
        } finally {
            document.getElementById("btnReset").disabled = false;
        }
    });
    </script>
</body>
</html>
