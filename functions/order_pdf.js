function parseAuth(authHeader) {
  if (!authHeader || !authHeader.startsWith("Bearer ")) return null;
  const token = authHeader.replace("Bearer ", "");
  const parts = token.split(":");
  if (parts.length < 2) return null;
  if (parts[0] === "ADMIN") return { role: "admin" };
  if (parts[0] === "TOKEN") return { role: "client", clientId: parts[1] };
  return null;
}

function toPdfText(value) {
  const raw = String(value ?? "");
  const normalized = raw.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
  let out = "";
  for (let i = 0; i < normalized.length; i += 1) {
    const code = normalized.charCodeAt(i);
    if (code === 10 || code === 13 || code === 9) {
      out += " ";
    } else if (code >= 32 && code <= 126) {
      out += normalized[i];
    } else {
      out += "?";
    }
  }
  return out;
}

function escapePdfText(value) {
  return toPdfText(value).replace(/\\/g, "\\\\").replace(/\(/g, "\\(").replace(/\)/g, "\\)");
}

const LOGO_JPG_BASE64 = [
  "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",
].join("");
const LOGO_JPG_WIDTH = 600;
const LOGO_JPG_HEIGHT = 188;
const ENSEIGNE_JPG_BASE64 = [
  "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",
].join("");
const ENSEIGNE_JPG_WIDTH = 600;
const ENSEIGNE_JPG_HEIGHT = 153;

function base64ToBytes(b64) {
  const binary = atob(b64);
  const len = binary.length;
  const bytes = new Uint8Array(len);
  for (let i = 0; i < len; i += 1) {
    bytes[i] = binary.charCodeAt(i);
  }
  return bytes;
}

function decodeBase64(base64) {
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
  const lookup = new Uint8Array(256);
  for (let i = 0; i < lookup.length; i += 1) lookup[i] = 255;
  for (let i = 0; i < chars.length; i += 1) lookup[chars.charCodeAt(i)] = i;

  const clean = base64.replace(/[^A-Za-z0-9+/=]/g, "");
  const len = clean.length;
  const buffer = new Uint8Array(((len * 3) / 4) | 0);
  let out = 0;
  let i = 0;
  while (i < len) {
    const c1 = lookup[clean.charCodeAt(i++)];
    const c2 = lookup[clean.charCodeAt(i++)];
    const c3 = lookup[clean.charCodeAt(i++)];
    const c4 = lookup[clean.charCodeAt(i++)];
    if (c2 === 255) break;
    const b1 = (c1 << 2) | (c2 >> 4);
    buffer[out++] = b1;
    if (c3 === 64 || c3 === 255) break;
    const b2 = ((c2 & 15) << 4) | (c3 >> 2);
    buffer[out++] = b2;
    if (c4 === 64 || c4 === 255) break;
    const b3 = ((c3 & 3) << 6) | c4;
    buffer[out++] = b3;
  }
  return buffer.slice(0, out);
}

let logoBytesCache = null;
function getLogoBytes() {
  if (logoBytesCache) return logoBytesCache;
  try {
    logoBytesCache = base64ToBytes(LOGO_JPG_BASE64);
  } catch (_) {
    logoBytesCache = decodeBase64(LOGO_JPG_BASE64);
  }
  return logoBytesCache;
}

let enseigneBytesCache = null;
function getEnseigneBytes() {
  if (enseigneBytesCache) return enseigneBytesCache;
  try {
    enseigneBytesCache = base64ToBytes(ENSEIGNE_JPG_BASE64);
  } catch (_) {
    enseigneBytesCache = decodeBase64(ENSEIGNE_JPG_BASE64);
  }
  return enseigneBytesCache;
}

function num(value) {
  return Number(value || 0)
    .toFixed(2)
    .replace(".", ",");
}

function formatEuro(value) {
  return `${num(value)} EUR`;
}

class PdfBuilder {
  constructor() {
    this.ops = [];
  }

  add(op) {
    this.ops.push(op);
  }

  setLineWidth(w) {
    this.add(`${w} w`);
  }

  setStrokeColor(r, g, b) {
    this.add(`${r} ${g} ${b} RG`);
  }

  setFillColor(r, g, b) {
    this.add(`${r} ${g} ${b} rg`);
  }

  text(x, y, text, font, size) {
    const safe = escapePdfText(text);
    this.add(`BT /${font} ${size} Tf 1 0 0 1 ${x} ${y} Tm (${safe}) Tj ET`);
  }

  line(x1, y1, x2, y2) {
    this.add(`${x1} ${y1} m ${x2} ${y2} l S`);
  }

  rect(x, y, w, h, fill, stroke) {
    if (fill && stroke) {
      this.add(`${x} ${y} ${w} ${h} re B`);
      return;
    }
    if (fill) {
      this.add(`${x} ${y} ${w} ${h} re f`);
      return;
    }
    this.add(`${x} ${y} ${w} ${h} re S`);
  }

  triangle(x1, y1, x2, y2, x3, y3, fill, stroke) {
    if (fill && stroke) {
      this.add(`${x1} ${y1} m ${x2} ${y2} l ${x3} ${y3} l h B`);
      return;
    }
    if (fill) {
      this.add(`${x1} ${y1} m ${x2} ${y2} l ${x3} ${y3} l h f`);
      return;
    }
    this.add(`${x1} ${y1} m ${x2} ${y2} l ${x3} ${y3} l h S`);
  }

  image(name, x, y, w, h) {
    this.add(`q ${w} 0 0 ${h} ${x} ${y} cm /${name} Do Q`);
  }

  build() {
    return this.ops.join("\n") + "\n";
  }
}

function buildPdfDocument(content, image) {
  const encoder = new TextEncoder();
  const contentBytes = encoder.encode(content);
  const objects = [];
  const parts = [];
  let length = 0;
  const offsets = [0];

  const appendStr = (str) => {
    parts.push(str);
    length += encoder.encode(str).length;
  };
  const appendBytes = (bytes) => {
    parts.push(bytes);
    length += bytes.length;
  };

  const images = (image || []).filter((img) => img && img.bytes && img.bytes.length);
  const hasImages = images.length > 0;
  const xObjectEntries = images.map((img) => `/${img.name} ${img.obj} 0 R`).join(" ");
  const resources = hasImages
    ? `/Resources << /Font << /F1 5 0 R /F2 6 0 R >> /XObject << ${xObjectEntries} >> >>`
    : "/Resources << /Font << /F1 5 0 R /F2 6 0 R >> >>";

  objects.push("1 0 obj\n<< /Type /Catalog /Pages 2 0 R >>\nendobj\n");
  objects.push("2 0 obj\n<< /Type /Pages /Kids [3 0 R] /Count 1 >>\nendobj\n");
  objects.push(
    `3 0 obj\n<< /Type /Page /Parent 2 0 R /MediaBox [0 0 595 842] /Contents 4 0 R ${resources} >>\nendobj\n`
  );

  objects.push(`4 0 obj\n<< /Length ${contentBytes.length} >>\nstream\n${content}endstream\nendobj\n`);
  objects.push("5 0 obj\n<< /Type /Font /Subtype /Type1 /BaseFont /Helvetica >>\nendobj\n");
  objects.push("6 0 obj\n<< /Type /Font /Subtype /Type1 /BaseFont /Helvetica-Bold >>\nendobj\n");

  if (hasImages) {
    images.forEach((img) => {
      const header =
        `${img.obj} 0 obj\n<< /Type /XObject /Subtype /Image /Width ${img.width} /Height ${img.height} ` +
        "/ColorSpace /DeviceRGB /BitsPerComponent 8 /Filter /DCTDecode " +
        `/Length ${img.bytes.length} >>\nstream\n`;
      const footer = "\nendstream\nendobj\n";
      objects.push({ header, bytes: img.bytes, footer });
    });
  }

  appendStr("%PDF-1.4\n");
  objects.forEach((obj) => {
    offsets.push(length);
    if (typeof obj === "string") {
      appendStr(obj);
    } else {
      appendStr(obj.header);
      appendBytes(obj.bytes);
      appendStr(obj.footer);
    }
  });

  const xrefStart = length;
  let xref = `xref\n0 ${objects.length + 1}\n`;
  xref += "0000000000 65535 f \n";
  for (let i = 1; i < offsets.length; i += 1) {
    const off = String(offsets[i]).padStart(10, "0");
    xref += `${off} 00000 n \n`;
  }
  appendStr(xref);
  appendStr(`trailer\n<< /Size ${objects.length + 1} /Root 1 0 R >>\nstartxref\n${xrefStart}\n%%EOF`);

  const total = length;
  const out = new Uint8Array(total);
  let offset = 0;
  parts.forEach((part) => {
    if (typeof part === "string") {
      const bytes = encoder.encode(part);
      out.set(bytes, offset);
      offset += bytes.length;
    } else {
      out.set(part, offset);
      offset += part.length;
    }
  });
  return out;
}

function clampText(text, max) {
  const safe = toPdfText(text || "");
  if (safe.length <= max) return safe;
  return `${safe.slice(0, Math.max(0, max - 3))}...`;
}

function textWidth(text, size) {
  return toPdfText(text || "").length * size * 0.5;
}

function buildOrderPdf({ row, payload, produits, catalogById }) {
  const pdf = new PdfBuilder();
  const pageW = 595;
  const pageH = 842;
  const margin = 40;

  const headerTop = pageH - margin;
  const logoX = margin;
  const logoW = 120;
  const logoH = Math.round((LOGO_JPG_HEIGHT / LOGO_JPG_WIDTH) * logoW);
  const logoY = headerTop - logoH;
  pdf.image("ImDigi", logoX, logoY, logoW, logoH);

  const enseigneW = 130;
  const enseigneH = Math.round((ENSEIGNE_JPG_HEIGHT / ENSEIGNE_JPG_WIDTH) * enseigneW);
  const enseigneX = pageW - margin - enseigneW;
  const enseigneY = headerTop - enseigneH;
  pdf.image("ImEns", enseigneX, enseigneY, enseigneW, enseigneH);

  const infoX = pageW - margin - 220;
  const infoY = headerTop - Math.max(logoH, enseigneH) - 8;
  pdf.text(infoX, infoY, `Date : ${row.date ? new Date(row.date).toLocaleDateString("fr-FR") : "-"}`, "F1", 9);
  pdf.text(infoX, infoY - 14, `Enseigne : ${payload.enseigne || ""}`, "F1", 9);
  pdf.text(infoX, infoY - 28, `Magasin : ${payload.magasin || ""}`, "F1", 9);
  pdf.text(infoX, infoY - 42, `Contact : ${payload.contact || ""}`, "F1", 9);

  const titleY = infoY - 68;
  pdf.text(margin, titleY, "BON DE COMMANDE CONSOMMABLES", "F2", 12);

  const tableX = margin;
  const tableTop = titleY - 20;
  const headerH = 18;
  const rowH = 16;
  const cols = [
    { key: "qty", label: "Qte", w: 50 },
    { key: "designation", label: "Designation", w: 300 },
    { key: "prix", label: "P.U. HT", w: 75 },
    { key: "total", label: "Total HT", w: 90 },
  ];
  const tableW = cols.reduce((acc, c) => acc + c.w, 0);
  const rows = produits.filter((p) => Number(p.qty || 0) > 0);
  const maxRows = Math.max(0, Math.floor((tableTop - 170) / rowH));
  const rowsToShow = rows.slice(0, maxRows);

  pdf.setLineWidth(0.8);
  pdf.setStrokeColor(0, 0, 0);
  pdf.rect(tableX, tableTop - headerH, tableW, headerH, false, true);
  let cursorX = tableX;
  cols.forEach((col) => {
    pdf.text(cursorX + 2, tableTop - 12, col.label, "F2", 8);
    cursorX += col.w;
  });

  pdf.setLineWidth(0.5);
  pdf.line(tableX, tableTop - headerH, tableX + tableW, tableTop - headerH);
  pdf.line(tableX, tableTop, tableX + tableW, tableTop);

  rowsToShow.forEach((p, idx) => {
    const y = tableTop - headerH - rowH * idx - 12;
    const pid = Number(p.id || 0);
    const cat = catalogById[pid] || {};
    const designation = cat.designation || cat.nom || p.nom || "";
    const prix = Number(p.prix || 0);
    const qty = Number(p.qty || 0);
    const total = prix * qty;

    let x = tableX + 2;
    pdf.text(x, y, String(qty), "F1", 8);
    x += cols[0].w;
    pdf.text(x, y, clampText(designation, 48), "F1", 8);
    x += cols[1].w;
    pdf.text(x, y, num(prix), "F1", 8);
    x += cols[2].w;
    pdf.text(x, y, num(total), "F1", 8);
  });

  if (rows.length > rowsToShow.length) {
    pdf.text(tableX, tableTop - headerH - rowH * rowsToShow.length - 10, `... ${rows.length - rowsToShow.length} ligne(s) non affichee(s)`, "F1", 8);
  }

  const sousTotal = rows.reduce((acc, p) => acc + Number(p.prix || 0) * Number(p.qty || 0), 0);
  const totalHt = Number(row.total_ht != null ? row.total_ht : sousTotal);
  const fraisPort = payload.fraisPort ?? payload.frais_port ?? Math.max(0, totalHt - sousTotal);
  const tvaRate = Number(row.tva != null ? row.tva : payload.tva ?? 0.2);
  const totalTtc = Number(row.total_ttc != null ? row.total_ttc : totalHt + totalHt * tvaRate);
  const tvaPct = `${(tvaRate * 100).toFixed(1).replace(".", ",")}%`;

  const tableBottom = tableTop - headerH - rowH * rowsToShow.length;
  const totalsBoxW = 210;
  const totalsBoxH = 78;
  const totalsX = pageW - margin - totalsBoxW;
  const totalsY = tableBottom - totalsBoxH - 12;

  pdf.setLineWidth(0.6);
  pdf.rect(totalsX, totalsY, totalsBoxW, totalsBoxH, false, true);
  pdf.text(totalsX + 8, totalsY + 60, `Sous-total HT : ${formatEuro(sousTotal)}`, "F1", 8);
  pdf.text(totalsX + 8, totalsY + 46, `Frais de port : ${formatEuro(fraisPort)}`, "F1", 8);
  pdf.text(totalsX + 8, totalsY + 32, `Total HT : ${formatEuro(totalHt)}`, "F1", 8);
  pdf.text(totalsX + 8, totalsY + 18, `TVA ${tvaPct} : ${formatEuro(totalHt * tvaRate)}`, "F1", 8);
  pdf.text(totalsX + 8, totalsY + 4, `Total TTC : ${formatEuro(totalTtc)}`, "F2", 8);

  pdf.setLineWidth(0.5);
  pdf.line(margin, 80, pageW - margin, 80);
  const footerLine1 =
    "Societe Anonyme au capital de 1 141 000 EUR - R.C.S. 404165631 Bobigny - APE 4669 B";
  const footerLine2 =
    "SIRET: 404165631 00049 - N TVA FR09404165631 | TVA acquittee sur les debits";
  const footerSize = 7;
  const footerX1 = (pageW - textWidth(footerLine1, footerSize)) / 2;
  const footerX2 = (pageW - textWidth(footerLine2, footerSize)) / 2;
  pdf.text(footerX1, 66, footerLine1, "F1", footerSize);
  pdf.text(footerX2, 54, footerLine2, "F1", footerSize);

  return buildPdfDocument(pdf.build(), [
    { name: "ImDigi", obj: 7, bytes: getLogoBytes(), width: LOGO_JPG_WIDTH, height: LOGO_JPG_HEIGHT },
    { name: "ImEns", obj: 8, bytes: getEnseigneBytes(), width: ENSEIGNE_JPG_WIDTH, height: ENSEIGNE_JPG_HEIGHT },
  ]);
}

export async function onRequestGet(context) {
  try {
    const auth = parseAuth(context.request.headers.get("Authorization") || "");
    if (!auth) {
      return new Response(JSON.stringify({ error: "Unauthorized" }), {
        status: 401,
        headers: { "content-type": "application/json" },
      });
    }

    const url = new URL(context.request.url);
    const orderId = url.searchParams.get("orderId");
    if (!orderId) {
      return new Response(JSON.stringify({ error: "orderId requis" }), {
        status: 400,
        headers: { "content-type": "application/json" },
      });
    }

    const db = context.env.DB;
    const res = await db
      .prepare(
        `SELECT id, client_id, date, total_ht, tva, total_ttc, status, payload
         FROM commandes
         WHERE id = ?1`
      )
      .bind(orderId)
      .all();
    const row = (res.results || [])[0];
    if (!row) {
      return new Response(JSON.stringify({ error: "Commande introuvable" }), {
        status: 404,
        headers: { "content-type": "application/json" },
      });
    }

    if (auth.role === "client" && auth.clientId !== row.client_id) {
      return new Response(JSON.stringify({ error: "Forbidden" }), {
        status: 403,
        headers: { "content-type": "application/json" },
      });
    }

    let payload = {};
    try {
      payload = JSON.parse(row.payload || "{}");
    } catch (_) {
      payload = {};
    }

    const produits = Array.isArray(payload.produits) ? payload.produits : [];
    const ids = Array.from(
      new Set(
        produits
          .map((p) => Number(p.id))
          .filter((id) => !Number.isNaN(id) && id > 0)
      )
    );
    const catalogById = {};
    if (ids.length) {
      const placeholders = ids.map((_, i) => `?${i + 1}`).join(",");
      const catRes = await db
        .prepare(
          `SELECT id, reference, nom, designation, mandrin, etiquettes_par_rouleau, rouleaux_par_carton
           FROM catalog_produits
           WHERE id IN (${placeholders})`
        )
        .bind(...ids)
        .all();
      (catRes.results || []).forEach((p) => {
        catalogById[Number(p.id)] = p;
      });
    }

    const pdfBytes = buildOrderPdf({ row, payload, produits, catalogById });

    return new Response(pdfBytes, {
      status: 200,
      headers: {
        "content-type": "application/pdf",
        "content-disposition": `inline; filename="commande_${row.id}.pdf"`,
      },
    });
  } catch (e) {
    return new Response(JSON.stringify({ error: e.toString() }), {
      status: 500,
      headers: { "content-type": "application/json" },
    });
  }
}
